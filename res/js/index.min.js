!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i,o=t();for(i in o)("object"==typeof exports?exports:e)[i]=o[i]}}(this,function(){return i=[,function(e,t){axios.get(window.prefix+"/api/comm/initData",{}).then(e=>{let t=e.data;new Vue({el:"#fileApp",data:function(){let e=null;return{socket:e=io?io(t.wsHost):e,config:t.rtcConfig,options:t.options,isJoined:!1,showReceiveFile:!1,showSendFile:!1,showReceiveTxt:!1,showLogs:!1,numSendFile:150,numReceiveFile:150,numReceiveTxt:150,numLogs:150,currentMenu:1,logsHeight:0,allManCount:0,isTxtMode:!1,txtEditId:0,nickName:"",socketId:0,roomId:"10086",recoderId:0,rtcConns:{},remoteMap:{},chunkSize:16384,allSended:!1,isSending:!1,currentReceiveSize:0,currentSendSize:0,currentReceiveAllSize:0,sendingIconInterverlId:0,currentChooseFile:null,chooseFileList:[],sendFileList:[],receiveFileList:[],receiveTxtList:[],chatingList:[],logs:[],isScreen:!1,screenTimes:0,isScreenShare:!1,screenShareTimes:0,isVideoShare:!1,videoShareTimes:0,switchData:{},switchDataGet:!1,token:"",manageIframeId:0}},computed:{createDisabled:function(){return this.isJoined||0<this.chooseFileList.length},exsitDisabled:function(){return!this.isJoined},uploadDisabled:function(){return 0==this.chooseFileList.length||this.allSended},showSendFileList:function(){return this.sendFileList&&5<this.sendFileList.length},noOthersInRoom:function(){return 0===Object.keys(this.remoteMap).length},isMobile:function(){return navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)}},watch:{allManCount:function(e,t){},currentMenu:function(e,t){},allSended:function(e,t){},isSending:function(e,t){!0===e?this.sendingIconInterverlId=setInterval(()=>{$("#isSendingIcon").css("color","#4c7673"),setTimeout(()=>{$("#isSendingIcon").css("color","#07c7b5")},500)},1e3):clearInterval(this.sendingIconInterverlId)},currentReceiveSize:function(e,t){this.currentReceiveSize=e},remoteMap:{handler:function(e,t){},deep:!0,immediate:!0},receiveFileList:{handler:function(e,t){},deep:!0,immediate:!0},receiveTxtList:{handler:function(e,t){},deep:!0,immediate:!0},sendFileList:{handler:function(e,t){},deep:!0,immediate:!0},chatingList:{handler:function(e,t){},deep:!0,immediate:!0},chooseFileList:{handler:function(e,t){let n=this;this.socketId&&e.forEach(i=>{document.querySelector("#sendProgress").max+=i.size,n.allSended=!1;var e,t=[];for(e in n.remoteMap)n.setRemoteInfo(e,{[i.index+"offset"]:0,[i.index+"status"]:0,[i.index+"file"]:i,[i.index+"reader"]:new FileReader}),t.push(e);let o="";0<t.length&&(o+="发送给房间的 "+t[0]+" ...等"+t.length+"人");for(let t in n.remoteMap)0<n.sendFileList.filter(e=>i.name===e.name&&i.size===e.size&&i.type===e.type&&i.id===t).length||n.sendFileList.push({index:i.index,id:t,name:i.name,size:i.size,type:i.type,process:0,done:!1,toIdStr:o,start:0,cost:0})})},deep:!0,immediate:!0}},methods:{coffee:function(){window.layer&&layer.open({type:1,fixed:!1,maxmin:!1,shadeClose:!0,area:["300px","350px"],title:"请楼主喝一杯咖啡",success:function(e,t){document.querySelector(".layui-layer-title").style.borderTopRightRadius="15px",document.querySelector(".layui-layer-title").style.borderTopLeftRadius="15px",document.querySelector(".layui-layer").style.borderRadius="15px",document.querySelector(".layui-layer-title").style.fontWeight="bold",document.querySelector(".layui-layer-title").style.color="#ffffff",document.querySelector(".layui-layer-title").style.borderBottom="none",document.querySelector(".layui-layer-title").style.backgroundColor="#000000"},content:'<img style=" width: 100%; height: 100%;border-bottom-left-radius: 15px; border-bottom-right-radius: 15px;" src="/image/coffee.jpg" alt="img"> '})},setting:function(){let o=this;var e;window.layer&&(e={type:1,fixed:!1,maxmin:!1,shadeClose:!0,area:["300px","350px"],title:"功能设置",success:function(e,t){let i=null;1===o.currentMenu?i=document.querySelector("#btnHome"):2===o.currentMenu?i=document.querySelector("#btnReceive"):3===o.currentMenu&&(i=document.querySelector("#btnTxt")),document.querySelector(".layui-layer-title").style.borderTopRightRadius="15px",document.querySelector(".layui-layer-title").style.borderTopLeftRadius="15px",document.querySelector(".layui-layer").style.borderRadius="15px",document.querySelector(".layui-layer-content").style.borderRadius="15px",document.querySelector(".setting-main-body ul").style.backgroundColor=i.style.getPropertyValue("--bgColorBody"),document.querySelector(".layui-layer-title").style.backgroundColor=i.style.getPropertyValue("--bgColorBody"),document.querySelector(".layui-layer").style.backgroundColor=i.style.getPropertyValue("--bgColorBody")},content:`
                        <div class="setting-main">
                            <div class="setting-main-body">
                                <ul class="layui-row layui-col-space10">
                                    <li class="layui-col-xs4">
                                        <a title="博客" href="https://blog.iamtsm.cn" target="_blank">
                                            <svg  viewBox="0 0 1024 1024" p-id="4914" width="42px" height="56px" id="blog">
                                                <path d="M512 520m-480 0a480 480 0 1 0 960 0 480 480 0 1 0-960 0Z" fill="#F8C5B9" p-id="4915">
                                                </path>
                                                <path
                                                    d="M512 1020c-276 0-500-224-500-500S236 20 512 20s500 224 500 500-224.8 500-500 500z m0-960C258.4 60 52 266.4 52 520s206.4 460 460 460 460-206.4 460-460S765.6 60 512 60z"
                                                    p-id="4916"></path>
                                                <path
                                                    d="M277.6 276c5.6 0.8 9.6-4 8.8-9.6-8-46.4-43.2-227.2-100-237.6C132 18.4 12.8 137.6 32 189.6c20.8 56 200 80.8 245.6 86.4z"
                                                    fill="#F8C5B9" p-id="4917"></path>
                                                <path
                                                    d="M278.4 296h-3.2c-88-10.4-238.4-37.6-261.6-99.2C-0.8 158.4 32 112 52.8 87.2 89.6 44 148 1.6 189.6 9.6c33.6 6.4 81.6 56 116 254.4 1.6 8.8-0.8 17.6-7.2 24-5.6 4.8-12.8 8-20 8zM178.4 48c-20 0-60.8 24.8-95.2 64.8-28 32.8-36.8 59.2-32.8 69.6 9.6 27.2 96 56 212.8 71.2-24-129.6-59.2-201.6-81.6-205.6h-3.2z"
                                                    p-id="4918"></path>
                                                <path
                                                    d="M751.2 276c-5.6 0.8-9.6-4-8.8-9.6 8-46.4 43.2-227.2 100-237.6 54.4-10.4 172.8 108.8 153.6 160.8-20.8 56-199.2 80.8-244.8 86.4z"
                                                    fill="#F8C5B9" p-id="4919"></path>
                                                <path
                                                    d="M750.4 296c-8 0-15.2-3.2-20-8.8-6.4-6.4-8.8-15.2-7.2-24C757.6 64.8 804.8 16 838.4 9.6c41.6-8 100 35.2 136.8 77.6 20.8 24.8 53.6 71.2 40 109.6-23.2 61.6-173.6 88.8-261.6 99.2h-3.2z m99.2-248h-4c-22.4 4-56.8 76-81.6 205.6 116-15.2 202.4-44 212.8-71.2 4-10.4-4.8-36.8-32.8-69.6-33.6-40-74.4-64.8-94.4-64.8zM509.6 859.2c-82.4 0-128.8-58.4-130.4-61.6L361.6 776h284l-12 20.8c-1.6 2.4-37.6 61.6-122.4 62.4h-1.6z m-84.8-56c18.4 13.6 47.2 28.8 84.8 28.8h1.6c38.4-0.8 64-15.2 80-28.8H424.8z"
                                                    p-id="4920"></path>
                                                <path
                                                    d="M354.4 789.6c-12.8 0-21.6-12.8-16.8-24.8 15.2-37.6 59.2-104.8 175.2-103.2 113.6 1.6 158.4 65.6 174.4 102.4 5.6 12-3.2 25.6-16.8 25.6H354.4z"
                                                    fill="#EF866D" p-id="4921"></path>
                                                <path
                                                    d="M669.6 803.2H354.4c-10.4 0-20.8-5.6-26.4-14.4-5.6-8.8-7.2-20-3.2-29.6 17.6-41.6 64-111.2 184-111.2h4c121.6 1.6 168.8 69.6 186.4 110.4 4 9.6 3.2 21.6-2.4 30.4-6.4 8.8-16 14.4-27.2 14.4z m-160.8-128c-104 0-144 59.2-158.4 94.4-0.8 1.6 0 3.2 0.8 4 0.8 0.8 1.6 2.4 4 2.4h315.2c2.4 0 3.2-1.6 4-2.4 0.8-0.8 1.6-2.4 0-4.8-15.2-34.4-56-92.8-161.6-94.4-1.6 0.8-3.2 0.8-4 0.8z"
                                                    p-id="4922"></path>
                                                <path
                                                    d="M368 674.4c-3.2 0-6.4-0.8-9.6-3.2-5.6-4.8-6.4-13.6-0.8-19.2 36.8-40 88.8-60.8 155.2-59.2 64 0.8 115.2 20.8 152 58.4 5.6 5.6 4.8 14.4 0 19.2-5.6 5.6-14.4 4.8-19.2 0-31.2-32-76-48.8-132.8-49.6-57.6-0.8-103.2 16-134.4 50.4-3.2 1.6-7.2 3.2-10.4 3.2z"
                                                    p-id="4923"></path>
                                                <path
                                                    d="M368 618.4c-3.2 0-6.4-0.8-9.6-3.2-5.6-4.8-6.4-13.6-0.8-19.2 36.8-40 88.8-60.8 155.2-59.2 64 0.8 115.2 20.8 152 58.4 5.6 5.6 4.8 14.4 0 19.2-5.6 5.6-14.4 4.8-19.2 0-31.2-32-76-48.8-132.8-49.6-57.6-0.8-103.2 16-134.4 50.4-3.2 1.6-7.2 3.2-10.4 3.2z"
                                                    p-id="4924"></path>
                                                <path d="M456 734.4m-24 0a24 24 0 1 0 48 0 24 24 0 1 0-48 0Z" p-id="4925"></path>
                                                <path d="M568 734.4m-24 0a24 24 0 1 0 48 0 24 24 0 1 0-48 0Z" p-id="4926"></path>
                                                <path d="M133.6 655.2a87.2 40 0 1 0 174.4 0 87.2 40 0 1 0-174.4 0Z" fill="#EF866D" p-id="4927">
                                                </path>
                                                <path d="M709.6 655.2a87.2 40 0 1 0 174.4 0 87.2 40 0 1 0-174.4 0Z" fill="#EF866D" p-id="4928">
                                                </path>
                                                <path d="M284 478.4a72 48 90 1 0 96 0 72 48 90 1 0-96 0Z" p-id="4929"></path>
                                                <path d="M644 478.4a72 48 90 1 0 96 0 72 48 90 1 0-96 0Z" p-id="4930"></path>
                                                <path d="M353.6 473.6m-8 0a8 8 0 1 0 16 0 8 8 0 1 0-16 0Z" fill="#FFFFFF" p-id="4931"></path>
                                                <path d="M329.6 465.6m-8 0a8 8 0 1 0 16 0 8 8 0 1 0-16 0Z" fill="#FFFFFF" p-id="4932"></path>
                                                <path d="M705.6 473.6m-8 0a8 8 0 1 0 16 0 8 8 0 1 0-16 0Z" fill="#FFFFFF" p-id="4933"></path>
                                                <path d="M681.6 465.6m-8 0a8 8 0 1 0 16 0 8 8 0 1 0-16 0Z" fill="#FFFFFF" p-id="4934"></path>
                                            </svg>
                                            <cite>个人博客</cite>
                                        </a>
                                    </li>

                                    <li class="layui-col-xs4">
                                        <a title="github" href="https://github.com/iamtsm" target="_blank">
                                            <svg width="42px" height="56px" id="github" viewBox="0 0 1049 1024" p-id="2500" width="64"
                                                height="64">
                                                <path
                                                    d="M524.979332 0C234.676191 0 0 234.676191 0 524.979332c0 232.068678 150.366597 428.501342 358.967656 498.035028 26.075132 5.215026 35.636014-11.299224 35.636014-25.205961 0-12.168395-0.869171-53.888607-0.869171-97.347161-146.020741 31.290159-176.441729-62.580318-176.441729-62.580318-23.467619-60.841976-58.234462-76.487055-58.234463-76.487055-47.804409-32.15933 3.476684-32.15933 3.476685-32.15933 53.019436 3.476684 80.83291 53.888607 80.83291 53.888607 46.935238 79.963739 122.553122 57.365291 152.97411 43.458554 4.345855-33.897672 18.252593-57.365291 33.028501-70.402857-116.468925-12.168395-239.022047-57.365291-239.022047-259.012982 0-57.365291 20.860106-104.300529 53.888607-140.805715-5.215026-13.037566-23.467619-66.926173 5.215027-139.067372 0 0 44.327725-13.906737 144.282399 53.888607 41.720212-11.299224 86.917108-17.383422 131.244833-17.383422s89.524621 6.084198 131.244833 17.383422C756.178839 203.386032 800.506564 217.29277 800.506564 217.29277c28.682646 72.1412 10.430053 126.029806 5.215026 139.067372 33.897672 36.505185 53.888607 83.440424 53.888607 140.805715 0 201.64769-122.553122 245.975415-239.891218 259.012982 19.121764 16.514251 35.636014 47.804409 35.636015 97.347161 0 70.402857-0.869171 126.898978-0.869172 144.282399 0 13.906737 9.560882 30.420988 35.636015 25.205961 208.601059-69.533686 358.967656-265.96635 358.967655-498.035028C1049.958663 234.676191 814.413301 0 524.979332 0z"
                                                    fill="#191717" p-id="2501"></path>
                                                <path
                                                    d="M199.040177 753.571326c-0.869171 2.607513-5.215026 3.476684-8.691711 1.738342s-6.084198-5.215026-4.345855-7.82254c0.869171-2.607513 5.215026-3.476684 8.691711-1.738342s5.215026 5.215026 4.345855 7.82254z m-6.953369-4.345856M219.900283 777.038945c-2.607513 2.607513-7.82254 0.869171-10.430053-2.607514-3.476684-3.476684-4.345855-8.691711-1.738342-11.299224 2.607513-2.607513 6.953369-0.869171 10.430053 2.607514 3.476684 4.345855 4.345855 9.560882 1.738342 11.299224z m-5.215026-5.215027M240.760389 807.459932c-3.476684 2.607513-8.691711 0-11.299224-4.345855-3.476684-4.345855-3.476684-10.430053 0-12.168395 3.476684-2.607513 8.691711 0 11.299224 4.345855 3.476684 4.345855 3.476684 9.560882 0 12.168395z m0 0M269.443034 837.011749c-2.607513 3.476684-8.691711 2.607513-13.906737-1.738342-4.345855-4.345855-6.084198-10.430053-2.607513-13.037566 2.607513-3.476684 8.691711-2.607513 13.906737 1.738342 4.345855 3.476684 5.215026 9.560882 2.607513 13.037566z m0 0M308.555733 853.526c-0.869171 4.345855-6.953369 6.084198-13.037566 4.345855-6.084198-1.738342-9.560882-6.953369-8.691711-10.430053 0.869171-4.345855 6.953369-6.084198 13.037566-4.345855 6.084198 1.738342 9.560882 6.084198 8.691711 10.430053z m0 0M351.145116 857.002684c0 4.345855-5.215026 7.82254-11.299224 7.82254-6.084198 0-11.299224-3.476684-11.299224-7.82254s5.215026-7.82254 11.299224-7.82254c6.084198 0 11.299224 3.476684 11.299224 7.82254z m0 0M391.126986 850.049315c0.869171 4.345855-3.476684 8.691711-9.560882 9.560882-6.084198 0.869171-11.299224-1.738342-12.168395-6.084197-0.869171-4.345855 3.476684-8.691711 9.560881-9.560882 6.084198-0.869171 11.299224 1.738342 12.168396 6.084197z m0 0"
                                                    fill="#191717" p-id="2502"></path>
                                            </svg>
                                            <cite>github</cite>
                                        </a>
                                    </li>

                                    <li class="layui-col-xs4" >
                                        <a title="webrtc检测" onclick="webrtcCheck()">
                                            <svg id="check" viewBox="0 0 1024 1024" p-id="7867" width="42px" height="56px">
                                                <path
                                                    d="M824.593094 277.816453l-202.741656 202.741657a20.48 20.48 0 1 1-28.963094-28.963094l202.741657-202.741657-14.481547-14.481546-202.741656 202.741656a20.48 20.48 0 1 1-28.963094-28.963094l217.223203-217.223203a20.48 20.48 0 0 1 28.963094 0l86.889281 86.889281a20.48 20.48 0 0 1 0 28.963094l-217.223203 217.223203a20.48 20.48 0 1 1-28.963094-28.963094l202.741656-202.741656-14.481547-14.481547z m-346.10897 119.038316c2.114306 0.955782 4.054833 2.317048 5.792619 4.054833l304.112484 304.112484a102.4 102.4 0 0 1-144.815469 144.815469l-304.112484-304.112485c-1.737786-1.737786-3.084569-3.692794-4.054833-5.792618a176.72192 176.72192 0 0 1-156.212446-49.077963 176.88576 176.88576 0 0 1-43.097084-180.092517 20.48 20.48 0 0 1 30.324359-11.005975c10.904605 6.820809 47.238806 28.6445 108.756417 65.311776l27.674237-27.99283c-37.145168-62.545801-59.026785-98.966891-65.282814-108.669528a20.48 20.48 0 0 1 10.745308-30.527101 176.90624 176.90624 0 0 1 181.091744 42.764008 176.72192 176.72192 0 0 1 49.077962 156.183483z m-100.270231 129.696733l294.322959 294.322959a61.44 61.44 0 1 0 86.889282-86.889281L465.103175 439.662221a176.55808 176.55808 0 0 1-35.697013 51.192268 176.55808 176.55808 0 0 1-51.192269 35.697013z m-170.056805-64.660106a135.96672 135.96672 0 1 0 78.982357-231.038599c12.64239 20.954798 32.264886 53.871354 58.997822 98.908965a20.48 20.48 0 0 1-3.041125 24.850334l-50.062707 50.64197A20.48 20.48 0 0 1 268.009322 408.440006c-44.74798-26.646046-77.60661-46.297505-98.691742-59.012303a135.84384 135.84384 0 0 0 38.868472 112.43473z m95.1148 337.246263a20.48 20.48 0 0 1-28.963093-28.963093l115.852375-115.852375a20.48 20.48 0 1 1 28.963093 28.963093l-115.852375 115.852375z"
                                                    fill="#2c2c2c" p-id="7868"></path>
                                                <path
                                                    d="M695.504586 777.429821m-21.722321 21.72232a30.72 30.72 0 1 0 43.444641-43.444641 30.72 30.72 0 1 0-43.444641 43.444641Z"
                                                    fill="#2c2c2c" p-id="7869"></path>
                                                <path
                                                    d="M152.446578 871.559875l50.685414-94.130054 43.44464-14.481547 43.444641 43.44464-14.481547 43.444641L181.409671 900.522969z"
                                                    fill="#2c2c2c" p-id="7870"></path>
                                            </svg>
                                            <cite >webrtc检测</cite>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs4" style="${this.switchData.openSendBug?"":"display:none;"}">
                                        <a title="反馈问题" onclick="sendBugs()" >
                                            <svg viewBox="0 0 1024 1024" p-id="4621" width="42px" height="56px" id="sendBugs">
                                                <path d="M360.389512 557.544289l184.919617 0 0 30.819936-184.919617 0 0-30.819936Z" p-id="4622">
                                                </path>
                                                <path d="M360.389512 480.981543l308.200384 0 0 30.819936-308.200384 0 0-30.819936Z" p-id="4623">
                                                </path>
                                                <path d="M360.389512 404.417773l308.200384 0 0 30.819936-308.200384 0 0-30.819936Z" p-id="4624">
                                                </path>
                                                <path
                                                    d="M511.999488 64.021106c-247.27171 0-447.724091 200.452381-447.724091 447.724091s200.452381 447.724091 447.724091 447.724091 447.724091-200.453405 447.724091-447.724091S759.271198 64.021106 511.999488 64.021106zM761.050728 620.157325c0 34.041304-27.599591 61.639872-61.640895 61.639872l-154.09968 0 0 123.280768L422.029384 681.798221 329.569576 681.798221c-34.040281 0-61.639872-27.599591-61.639872-61.639872L267.929704 373.597837c0-34.040281 27.599591-61.639872 61.639872-61.639872l369.840256 0c34.042327 0 61.640895 27.599591 61.640895 61.639872L761.050728 620.157325z"
                                                    p-id="4625"></path>
                                            </svg>
                                            <cite>反馈问题</cite>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        `},layer.open(e))},startVideoShare:function(){if(this.isScreenShare)window.layer&&layer.msg("当前正在屏幕共享中，退出后再试");else if(this.isVideoShare)window.Bus.$emit("stopVideoShare"),this.isVideoShare=!this.isVideoShare;else if(this.createDisabled)window.layer&&layer.msg("请先退出房间后，再发起音视频通话");else{let o=this;window.layer&&layer.prompt({formType:1,title:"请输入音视频通话房间号"},function(e,t,i){o.roomId=e,o.createMediaRoom("video"),layer.close(t),o.socket.emit("message",{emitType:"startVideoShare",room:o.roomId}),o.isVideoShare=!o.isVideoShare})}},startScreenShare:function(){if(this.isVideoShare)window.layer&&layer.msg("当前正在音视频通话中，退出后再试");else if(this.isScreenShare)window.Bus.$emit("stopScreenShare"),this.isScreenShare=!this.isScreenShare;else if(this.createDisabled)window.layer&&layer.msg("请先退出房间后，再发起屏幕共享");else{let o=this;window.layer&&layer.prompt({formType:1,title:"请输入屏幕共享房间号"},function(e,t,i){o.roomId=e,o.createMediaRoom("screen"),layer.close(t),o.socket.emit("message",{emitType:"startScreenShare",room:o.roomId}),o.isScreenShare=!o.isScreenShare})}},startScreen:function(){if(this.isMobile)window.layer&&layer.msg("移动端暂不支持屏幕录制");else{if(this.isScreen)window.Bus.$emit("stopScreen",e=>{this.receiveFileList.push({id:"网页录屏",href:e.src,style:"color: #ff5722;text-decoration: underline;",name:"screen-recording-"+e.donwId+".mp4",type:"webm/mp4",size:e.size,process:100,done:!0,start:0,cost:e.times}),this.socket.emit("message",{emitType:"stopScreen",room:this.roomId,size:e.size,cost:e.times})});else{let t=this;window.layer&&layer.confirm("是否进行本地屏幕录制",e=>{window.Bus.$emit("startScreen"),t.socket.emit("message",{emitType:"startScreen",room:this.roomId})},e=>{this.isScreen=!this.isScreen,layer.close(e)})}this.isScreen=!this.isScreen}},shareUrl:function(){document.querySelector("#shareUrl").setAttribute("data-clipboard-text",window.location.href+"#r="+this.roomId),new ClipboardJS("#shareUrl").on("success",function(e){e.clearSelection(),window.layer&&layer.msg("复制房间链接成功!")})},copyTxt:function(e,t){document.querySelector("#"+e).setAttribute("data-clipboard-text",t),new ClipboardJS("#"+e).on("success",function(e){e.clearSelection(),window.layer&&layer.msg("复制内容成功!")})},handlerRoomHistory:function(){let t=this;var e=window.location.hash||"";e&&e.includes("#")&&(e=e.split("r="))&&1<e.length&&(this.roomId=(e[1]+"").replace(/\s*/g,"").substr(0,15),window.layer)&&(layer.confirm("进入房间"+this.roomId,e=>{window.location.hash="",layer.close(e),t.createFileRoom()},e=>{t.roomId="",window.location.hash="",layer.close(e)}),this.addPopup("你通过分享加入了房间号为 "+this.roomId),this.logs.push("你通过分享加入了房间号为 "+this.roomId))},chating:function(){let o=this;var e;window.layer&&(e={type:1,fixed:!1,maxmin:!1,area:["600px","600px"],title:"公共聊天频道",success:function(e,t){let i=null;1===o.currentMenu?i=document.querySelector("#btnHome"):2===o.currentMenu?i=document.querySelector("#btnReceive"):3===o.currentMenu&&(i=document.querySelector("#btnTxt")),document.querySelector(".layui-layer-title").style.borderTopRightRadius="15px",document.querySelector(".layui-layer-title").style.borderTopLeftRadius="15px",document.querySelector(".layui-layer").style.borderRadius="15px",document.querySelector(".chating-content").style.backgroundColor=i.style.getPropertyValue("--bgColorBody"),document.querySelector(".layui-textarea").style.backgroundColor=i.style.getPropertyValue("--bgColorBody"),document.querySelector(".layui-layer-title").style.backgroundColor=i.style.getPropertyValue("--bgColorBody"),document.querySelector(".layui-layer").style.backgroundColor=i.style.getPropertyValue("--bgColorBody"),o.chatingTpl()},content:`
                            <div class="layui-col-sm12" style="padding: 15px;">
                                <div class="layui-card chating-content" id="chating_tpl_view" style="padding: 5px;"> </div>
                                <script id="chating_tpl" type="text/html">
                                    <div style="text-align: center; color: #ffe2bc; font-size: 12px;margin-top: -5px; margin-bottom: 20px;"> -------- 仅展示10条历史消息 -------- </div>
                                    {{#  layui.each(d, function(index, info){ }}
                                    <div style="margin-bottom: 30px;display: inline-flex;">
                                        <a > <img style="width: 32px; height: 32px;" src="/image/44826979.png" alt="img"> </a>
                                        <div style="margin-left: 15px; margin-top: -5px;">
                                            <div style="word-break: break-all;"> <small>房间号: <b>{{info.room}}</b></small> - <small>用户: <b>{{info.socketId}}</b></small> - <small>时间: <b>{{info.time}}</b></small> </div>
                                            <div style="margin-top: 5px;word-break: break-all;">说: <b style="font-weight: bold; font-size: large;"> {{info.msg}} </b></div>
                                        </div>
                                    </div>
                                    {{#  }); }}
                                </script>
                            </div>
                            <div style="bottom: 0px; position: absolute; width: 100%; padding: 20px;">
                                <textarea style="border-radius: 15px;" maxlength="50000" id="blog_comment" class="layui-textarea" placeholder="文明发言，理性交流 ~"></textarea>
                                <button style="float: right;margin-top: 10px;" onclick="sendChating()" type="button" class="layui-btn layui-btn-normal layui-btn-sm">发言</button>
                            </div>
                        `},this.isMobile&&delete e.area,e=layer.open(e),this.isMobile)&&layer.full(e)},chatingTpl:function(){var t=document.getElementById("chating_tpl"),i=document.getElementById("chating_tpl_view");if(t&&i){this.tpl(t,this.chatingList,i);t=document.querySelector("#chating_tpl_view");let e=0;t.clientHeight>(e=this.isMobile?document.documentElement.clientHeight-235:350)?(t.style.height=e+"px",t.style.overflowY="scroll"):t.style.overflowY="none"}},tpl:function(e,t,i){window.laytpl&&laytpl(e.innerHTML).render(t,e=>{i.innerHTML=e})},sendChating:function(){var e=document.querySelector("#blog_comment").value;this.createDisabled?""===e||void 0===e?window.layer&&layer.msg("请先填写内容哦"):1e3<e.length?window.layer&&layer.msg("内容太长啦，不能超过1000个字"):(this.socket.emit("chating",{recoderId:this.recoderId,msg:e,room:this.roomId,socketId:this.socketId,time:(new Date).toLocaleString()}),document.querySelector("#blog_comment").value=""):window.layer&&layer.msg("请先加入房间，才能发言哦")},sendBugs:function(){if(window.layer){let o=this;$("#sendBugs").removeClass("layui-anim-rotate"),setTimeout(()=>{$("#sendBugs").addClass("layui-anim-rotate")},50),setTimeout(()=>{layer.prompt({formType:2,title:"请描述您需要反馈的问题"},function(e,t,i){o.socket.emit("message",{emitType:"sendBugs",msg:e,room:o.roomId}),layer.msg("问题反馈成功，更多问题可以加群交流，将更快解决"),layer.close(t)})},500)}},refleshRoom:function(){this.createDisabled||(this.roomId=parseInt(1e5*Math.random()),this.addPopup("你刷新了房间号, 当前房间号为 "+this.roomId),this.logs.push("你刷新了房间号, 当前房间号为 "+this.roomId),$("#refresh").removeClass("layui-anim-rotate"),setTimeout(()=>{$("#refresh").addClass("layui-anim-rotate")},50))},addPopup:function(e){window.Bus.$emit("addPopup",e)},cleanPopup:function(){window.Bus.$emit("popupMap")},sendTxt:function(e){var t;this.createDisabled?this.noOthersInRoom?window.layer&&layer.msg("房间内至少需要两个人才能发送内容"):e?(t=layedit.getContent(this.txtEditId)).length<=0?window.layer&&layer.msg("请输入发送的富文本内容"):1e3<t.length?window.layer&&layer.msg("富文本文字内容过长，长度最多1w单词!"):(this.socket.emit("message",{emitType:"sendTxt",real:e,content:encodeURIComponent(t),room:this.roomId,from:this.socketId,recoderId:this.recoderId}),window.layer&&(window.layui&&window.layedit&&(this.txtEditId=window.layedit.build("txt",{tool:["strong","italic","underline","del","|","left","center","right","face"]})),this.sendFileList.push({id:"txt",name:t,size:t.length,type:"富文本内容",process:100,done:!0,toIdStr:"",start:0,cost:0}),layer.msg("富文本内容发送完毕"))):(t=layedit.getText(this.txtEditId)).length<=0?window.layer&&layer.msg("请输入发送的文本内容"):1e3<t.length?window.layer&&layer.msg("文字内容过长，最多1000单词!"):(this.socket.emit("message",{emitType:"sendTxt",real:e,content:encodeURIComponent(t),room:this.roomId,from:this.socketId,recoderId:this.recoderId}),window.layer&&(window.layui&&window.layedit&&(this.txtEditId=window.layedit.build("txt",{tool:["strong","italic","underline","del","|","left","center","right","face"]})),this.sendFileList.push({id:"txt",name:t,size:t.length,type:"文本内容",process:100,done:!0,toIdStr:"",start:0,cost:0}),layer.msg("内容发送完毕"))):window.layer&&layer.msg("请先加入房间，再发送内容")},clickHome:function(e=!0){this.currentMenu=1;var t=document.querySelector("#btnHome"),i=(document.querySelector("#iamtsm").style.backgroundColor=t.style.getPropertyValue("--bgColorBody"),document.querySelector("#chooseFileListDisable").style.backgroundColor=t.style.getPropertyValue("--bgColorBody"),document.querySelector("#chooseFileList").style.backgroundColor=t.style.getPropertyValue("--bgColorBody"),document.querySelector(".menuBorder")),t=t.getBoundingClientRect();t=Math.floor(t.left-i.closest("menu").offsetLeft-(i.offsetWidth-t.width)/2)+"px",i.style.transform=`translate3d(${t}, 0 , 0)`,e&&this.clickSendFile()},clickReceive:function(e=!0){this.currentMenu=2;var t=document.querySelector("#btnReceive"),i=(document.querySelector("#iamtsm").style.backgroundColor=t.style.getPropertyValue("--bgColorBody"),document.querySelector("#chooseFileListDisable").style.backgroundColor=t.style.getPropertyValue("--bgColorBody"),document.querySelector("#chooseFileList").style.backgroundColor=t.style.getPropertyValue("--bgColorBody"),document.querySelector(".menuBorder")),t=t.getBoundingClientRect();t=Math.floor(t.left-i.closest("menu").offsetLeft-(i.offsetWidth-t.width)/2)+"px",i.style.transform=`translate3d(${t}, 0 , 0)`,e&&this.clickReceiveFile()},clickTxt:function(e=!0){this.currentMenu=3;var t=document.querySelector("#btnTxt"),i=(document.querySelector("#iamtsm").style.backgroundColor=t.style.getPropertyValue("--bgColorBody"),document.querySelector("#chooseFileListDisable").style.backgroundColor=t.style.getPropertyValue("--bgColorBody"),document.querySelector("#chooseFileList").style.backgroundColor=t.style.getPropertyValue("--bgColorBody"),document.querySelector(".menuBorder")),t=t.getBoundingClientRect();t=Math.floor(t.left-i.closest("menu").offsetLeft-(i.offsetWidth-t.width)/2)+"px",i.style.transform=`translate3d(${t}, 0 , 0)`,e&&this.clickReceiveTxt()},getFileSizeStr:function(e){e=(e/1048576).toString();let t="";return e.split(".")[0]+"."+(t=e.split(".")[1]?e.split(".")[1].substr(0,3):t)+"M"},changeFileOrTxt:function(){this.isTxtMode=!this.isTxtMode,window.layui&&window.layedit&&(this.txtEditId=window.layedit.build("txt",{tool:["strong","italic","underline","del","|","left","center","right","face"]})),$("#changeMode").removeClass("layui-anim-rotate"),setTimeout(()=>{$("#changeMode").addClass("layui-anim-rotate"),window.layer&&layer.msg("切换为"+(this.isTxtMode?"文本模式":"文件模式"))},50)},clickReceiveFile:function(){this.showReceiveFile=!this.showReceiveFile,this.showReceiveFile?this.numReceiveFile=50:this.numReceiveFile=150},clickReceiveTxt:function(){this.showReceiveTxt=!this.showReceiveTxt,this.showReceiveTxt?this.numReceiveTxt=50:this.numReceiveTxt=150},clickSendFile:function(){this.showSendFile=!this.showSendFile,this.showSendFile?this.numSendFile=50:this.numSendFile=150},clickLogs:function(){this.showLogs=!this.showLogs,this.showLogs?this.numLogs=50:this.numLogs=150},createFileRoom:function(){this.roomId=this.roomId.toString().replace(/\s*/g,""),null===this.roomId||void 0===this.roomId||""===this.roomId?window.layer?layer.msg("请先填写房间号"):alert("请先填写房间号"):!this.switchData.allowChinese&&window.tlrtcfile.containChinese(this.roomId)?window.layer?layer.msg("房间号不允许中文"):alert("房间号不允许中文"):!this.switchData.allowNumber&&window.tlrtcfile.containNumber(this.roomId)?window.layer?layer.msg("房间号不允许数字"):alert("房间号不允许数字"):!this.switchData.allowSymbol&&window.tlrtcfile.containSymbol(this.roomId)?window.layer?layer.msg("房间号不允许特殊符号"):alert("房间号不允许特殊符号"):0<this.chooseFileList.length?window.layer?layer.msg("请先加入房间再选文件"):alert("请先加入房间再选文件"):this.roomId&&(15<this.roomId.toString().length?window.layer?layer.msg("房间号太长啦"):alert("房间号太长啦"):(this.socket.emit("createAndJoin",{room:this.roomId}),this.isJoined=!0,this.addPopup("你进入了房间"+this.roomId),this.logs.push("你进入了房间"+this.roomId)))},createMediaRoom:function(e){this.roomId=this.roomId.toString().replace(/\s*/g,""),null===this.roomId||void 0===this.roomId||""===this.roomId?window.layer?layer.msg("请先填写房间号"):alert("请先填写房间号"):this.roomId&&(15<this.roomId.toString().length?window.layer?layer.msg("房间号太长啦"):alert("房间号太长啦"):(this.socket.emit("createAndJoin",{room:this.roomId,type:e}),this.isJoined=!0,this.addPopup("你进入了房间"+this.roomId),this.logs.push("你进入了房间"+this.roomId)))},exitRoom:function(){for(var t in this.roomId&&this.socket.emit("exit",{from:this.socketId,room:this.roomId,recoderId:this.recoderId}),this.rtcConns){let e=this.rtcConns[t];e.close(),e=null}window.location.reload()},getRtcConnect:function(e){return this.rtcConns[e]},createRtcConnect:function(o){if(void 0!==o){let t=this,i=new RTCPeerConnection(this.config);return i.onicecandidate=e=>{t.iceCandidate(i,o,e)},this.rtcConns[o]=i,this.remoteMap[o]||Vue.set(this.remoteMap,o,{id:o}),this.initSendDataChannel(o),i.onremovestream=e=>{t.removeStream(i,o,e)},i}},getOrCreateRtcConnect:function(e){let t=this.getRtcConnect(e);return t=void 0===t?this.createRtcConnect(e):t},initMediaShareChannel:function(e,i,t,o){e=this.getOrCreateRtcConnect(e);e.ontrack=t=>{setTimeout(()=>{$("#mediaShareRoomList").append(`
                            <div class="swiper-slide mediaShareBlock">
                                <video id="otherMediaShareVideo" autoplay playsinline onclick="tlrtcfile.openFullVideo(this, '${i}')"></video>
                            </div>
                        `);var e=document.querySelector("#otherMediaShareVideo");e.srcObject=t.streams[0],e.play(),document.addEventListener("WeixinJSBridgeReady",function(){e.play()},!1)},100)},t&&o&&e.addTrack(t,o)},initSendDataChannel:function(t){let i=this,o=this.rtcConns[t].createDataChannel("sendDataChannel");o.binaryType="arraybuffer",o.addEventListener("open",e=>{"open"===o.readyState&&i.logs.push("建立连接 : channel open")}),o.addEventListener("close",e=>{"close"===o.readyState&&i.logs.push("连接关闭 : channel close")}),o.addEventListener("error",e=>{console.error(e.error),i.logs.push("连接断开 : "+e)}),this.rtcConns[t].addEventListener("datachannel",e=>{i.initReceiveDataChannel(e,t)}),this.setRemoteInfo(t,{sendChannel:o})},initSendFile:function(){this.changeSendFileNext(),this.sendFileToRemoteAllByLoop(),this.touchResize()},changeSendFileNext:async function(){var t=this;let i=null;for(let e=0;e<t.chooseFileList.length;e++){var o=t.chooseFileList[e];if(0===o.fileSendStatus){i=o;break}}null!==(t.currentChooseFile=i)&&(t.currentChooseFile.fileSendStatus=1,t.socket.emit("message",{emitType:"sendFileInfo",index:t.currentChooseFile.index,name:t.currentChooseFile.name,type:t.currentChooseFile.type,size:t.currentChooseFile.size,room:t.roomId,from:t.socketId,recoderId:t.recoderId}))},sendFileToRemoteAllByLoop:function(){let t=this;var e;null===this.currentChooseFile?(this.chooseFileList=[],console.log("文件全部发送完毕"),this.addPopup("文件全部发送完毕"),this.logs.push("文件全部发送完毕"),this.isSending=!1):(this.isSending=!0,""===(e=this.getSendFileNextRemote())?setTimeout(()=>{t.initSendFile()},1500):((e=this.remoteMap[e][this.currentChooseFile.index+"reader"]).addEventListener("loadend",this.sendFileToRemoteByLoop),e.addEventListener("error",e=>{t.logs.push("读取文件错误 : "+e)}),e.addEventListener("abort",e=>{t.logs.push("读取文件中断 : "+e)}),this.readSlice(0)))},sendFileToRemoteByLoop:function(t){let i=this;var o=this.getSendFileNextRemote();if(""!==o){var n=this.remoteMap[o],s=n[this.currentChooseFile.index+"offset"];let e=n.sendChannel;e&&"open"===e.readyState&&(this.setRemoteInfo(o,{[this.currentChooseFile.index+"status"]:1}),0===s&&(this.addPopup("正在发送给"+o.substr(0,4)+",0%。"),this.logs.push("正在发送给"+o.substr(0,4)+",0%。"),this.updateSendFileProcess(o,{start:Date.now()})),e.bufferedAmount>e.bufferedAmountLowThreshold?e.onbufferedamountlow=()=>{e.onbufferedamountlow=null,i.sendFileToRemoteByLoop(t)}:(e.send(t.target.result),s+=t.target.result.byteLength,n[this.currentChooseFile.index+"offset"]=s,this.currentSendSize+=t.target.result.byteLength,this.currentReceiveAllSize+=t.target.result.byteLength,this.updateSendFileProcess(o,{process:parseInt(s/this.currentChooseFile.size*100)}),s===this.currentChooseFile.size?(this.currentSendSize=0,this.addPopup("正在发送给"+o.substr(0,4)+",100%。"),this.logs.push("正在发送给"+o.substr(0,4)+",100%。"),this.socket.emit("message",{emitType:"sendDone",room:this.roomId,from:this.socketId,size:this.currentChooseFile.size,name:this.currentChooseFile.name,type:this.currentChooseFile.type,to:o}),this.updateSendFileProcess(o,{done:!0}),this.setRemoteInfo(o,{[this.currentChooseFile.index+"status"]:2}),this.sendFileToRemoteAllByLoop()):s<this.currentChooseFile.size&&this.readSlice(s+this.chunkSize)))}},getSendFileNextRemote:function(){let e="",t=!1;for(var i in this.remoteMap)1===(this.remoteMap[i][this.currentChooseFile.index+"status"]||0)&&(t=!0,e=i);if(!t)for(var o in this.remoteMap)0===(this.remoteMap[o][this.currentChooseFile.index+"status"]||0)&&(e=o);let n=!0;for(var s in this.remoteMap){s=this.remoteMap[s][this.currentChooseFile.index+"status"]||0;0!==s&&1!==s||(n=!1)}return n?(this.allSended=!0,this.currentChooseFile.fileSendStatus=2,""):e},readSlice:function(e){var t,i=this.getSendFileNextRemote();""!==i&&(t=(i=this.remoteMap[i])[this.currentChooseFile.index+"offset"],i=i[this.currentChooseFile.index+"reader"],t=this.currentChooseFile.slice(t,e+this.chunkSize),i.readAsArrayBuffer(t))},initReceiveDataChannel:function(t,i){if(i&&t&&this.getRemoteInfo(i)){let e=t.channel;e.binaryType="arraybuffer",e.onmessage=e=>{this.receiveData(e,i)},e.onopen=()=>{e.readyState},e.onclose=()=>{e.readyState},this.setRemoteInfo(i,{receiveChannel:e})}},receiveData:function(e,t){var i,o,n,s,r;e&&t&&((n=(r=this.getRemoteInfo(t)).receiveFiles)?(i=n.name,o=n.size,n=n.type,s=r.receiveBuffer||new Array,r=r.receivedSize||0,s.push(e.data),r+=e.data.byteLength,document.querySelector("#receiveProgress").value=r,this.setRemoteInfo(t,{receiveBuffer:s,receivedSize:r}),this.currentReceiveSize+=e.data.byteLength,this.updateReceiveProcess(t,{process:parseInt(r/o*100)}),r===o&&(console.log(i+" 接收完毕"),this.logs.push("接收完毕..."),document.querySelector("#receiveProgress").value=0,this.addPopup("文件[ "+i+" ]接收完毕，可点击右下角查看。"),this.updateReceiveProcess(t,{style:"color: #ff5722;text-decoration: underline;",href:URL.createObjectURL(new Blob(s),{type:n}),done:!0}),this.setRemoteInfo(t,{receiveBuffer:new Array,receivedSize:0}),this.currentReceiveSize=0)):setTimeout(()=>{this.receiveData(e,t)},500))},closeDataChannels:function(){for(var e in this.remoteMap){var t=e.id,i=e.sendChannel,e=e.receiveChannel;t&&i&&e&&(i.close(),e.close())}},setRemoteInfo(e,t){var i;e&&t&&(i=this.remoteMap[e])&&(Object.assign(i,t),Vue.set(this.remoteMap,e,i))},updateReceiveProcess:function(t,i){for(let e=0;e<this.receiveFileList.length;e++){var o=this.receiveFileList[e];o.id!==t||o.done||(0===o.start&&(o.start=Date.now()),i.cost=parseInt((Date.now()-o.start)/1e3),Object.assign(this.receiveFileList[e],i))}},updateSendFileProcess:function(t,i){for(let e=0;e<this.sendFileList.length;e++){var o=this.sendFileList[e];o.id!==t||o.index!==this.currentChooseFile.index||o.done||(i.cost=parseInt((Date.now()-o.start)/1e3),Object.assign(this.sendFileList[e],i))}},getRemoteInfo(e){if(e)return this.remoteMap[e]},removeStream:function(e,t,i){this.getOrCreateRtcConnect(t).close,delete this.rtcConns[t],delete this.remoteMap[t]},iceCandidate:function(e,t,i){null!=i.candidate&&(t={from:this.socketId,to:t,room:this.roomId,sdpMid:i.candidate.sdpMid,sdpMLineIndex:i.candidate.sdpMLineIndex,sdp:i.candidate.candidate},this.socket.emit("candidate",t))},offerSuccess:function(e,t,i){e.setLocalDescription(i).then(e=>{});e={from:this.socketId,to:t,room:this.roomId,sdp:i.sdp};this.socket.emit("offer",e)},offerFailed:function(e,t,i){this.logs.push("offer失败,"+i)},answerSuccess:function(e,t,i){e.setLocalDescription(i).then(e=>{});e={from:this.socketId,to:t,room:this.roomId,sdp:i.sdp};this.socket.emit("answer",e)},answerFailed:function(e,t,i){this.logs.push("answer失败,"+i)},addIceCandidateSuccess:function(e){this.logs.push("addIceCandidateSuccess成功,"+e)},addIceCandidateFailed:function(e){this.logs.push("addIceCandidate失败,"+e)},socketListener:function(){let s=this;this.socket.emit("count",{}),this.socket.on("created",async function(n){s.logs.push("创建房间,"+JSON.stringify(n)),s.socketId=n.id,s.roomId=n.room,s.recoderId=n.recoderId,"screen"===n.type&&0===n.peers.length&&window.Bus.$emit("startScreenShare",n.id),"video"===n.type&&0===n.peers.length&&window.Bus.$emit("startVideoShare",n.id);for(let e=0;e<n.peers.length;e++){let i=n.peers[e].id,o=s.getOrCreateRtcConnect(i);"screen"===n.type?window.Bus.$emit("startScreenShare",i,(e,t)=>{s.initMediaShareChannel(i,n.type,e,t),o.createOffer(s.options).then(e=>{s.offerSuccess(o,i,e)},e=>{s.offerFailed(o,i,e)})}):"video"===n.type?window.Bus.$emit("startVideoShare",i,(e,t)=>{s.initMediaShareChannel(i,n.type,e,t),o.createOffer(s.options).then(e=>{s.offerSuccess(o,i,e)},e=>{s.offerFailed(o,i,e)})}):o.createOffer(s.options).then(e=>{s.offerSuccess(o,i,e)},e=>{s.offerFailed(o,i,e)})}s.touchResize()}),this.socket.on("joined",function(i){s.logs.push("加入房间,"+JSON.stringify(i)),s.recoderId=i.recoderId,s.getOrCreateRtcConnect(i.id),"screen"===i.type&&window.Bus.$emit("getScreenShareTrackAndStream",(e,t)=>{s.initMediaShareChannel(i.id,i.type,e,t)}),"video"===i.type&&window.Bus.$emit("getVideoShareTrackAndStream",(e,t)=>{s.initMediaShareChannel(i.id,i.type,e,t)}),s.addPopup(i.id+"加入了房间。"),s.touchResize()}),this.socket.on("offer",function(t){s.logs.push("offer,"+JSON.stringify(t));let i=s.getOrCreateRtcConnect(t.from);var e={type:"offer",sdp:t.sdp};i.setRemoteDescription(new RTCSessionDescription(e)).then(e=>{}),i.createAnswer(s.options).then(e=>{s.answerSuccess(i,t.from,e)}).catch(e=>{s.answerFailed(i,t.from,e)})}),this.socket.on("answer",function(e){s.logs.push("answer,"+JSON.stringify(e));var t=s.getOrCreateRtcConnect(e.from),e={type:"answer",sdp:e.sdp};t.setRemoteDescription(new RTCSessionDescription(e)).then(e=>{})}),this.socket.on("candidate",function(e){s.logs.push("candidate,"+JSON.stringify(e));var t=s.getOrCreateRtcConnect(e.from),e=new RTCIceCandidate({candidate:e.sdp,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex});t.addIceCandidate(e).then(e=>{s.addIceCandidateSuccess(e)}).catch(e=>{s.addIceCandidateFailed(e)})}),this.socket.on("exit",function(e){void 0!==s.rtcConns[e.from]&&(s.addPopup(e.from+"退出了房间。"),s.logs.push("退出房间,"+JSON.stringify(e)),s.getOrCreateRtcConnect(e.from).close,delete s.rtcConns[e.from],Vue.delete(s.remoteMap,e.from),s.touchResize())}),this.socket.on("sendFileInfo",function(e){var t=e.from;s.setRemoteInfo(t,{receiveFiles:e}),s.addPopup(e.from+"选择了文件 [ "+e.name+" ]，即将发送。"),s.logs.push(e.from+"选择了文件 [ "+e.name+" ]，即将发送。"),document.querySelector("#receiveProgress").max=e.size,s.receiveFileList.push({id:t,index:e.index,href:"",name:e.name,type:e.type,size:e.size,process:0,done:!1,start:0,cost:0})}),this.socket.on("sendTxt",function(e){var t=e.from;s.addPopup(e.from+"发送了文字 [ "+e.content.substr(0,10)+" ]"),s.logs.push(e.from+"发送了文字 [ "+e.content.substr(0,10)+" ]"),s.receiveTxtList.push({id:t,real:e.real,content:decodeURIComponent(e.content),time:(new Date).toLocaleString(),c_id:"txt_"+s.receiveTxtList.length,process:0,done:!1,start:0,cost:0})}),this.socket.on("count",function(e){s.allManCount=e.mc}),this.socket.on("tips",function(e){window.layer&&layer.msg(e.msg)}),this.socket.on("stopScreenShare",function(e){(e.id===s.socketId?$("#selfMediaShareVideo"):$("#otherMediaShareVideo")).parent().remove()}),this.socket.on("stopVideoShare",function(e){(e.id===s.socketId?$("#selfMediaShareVideo"):$("#otherMediaShareVideo")).parent().remove()}),this.socket.on("commData",function(e){s.switchData=e.switchData,s.switchDataGet=!0,e.chatingData.forEach(e=>{s.chatingList.push(e)})}),this.socket.on("chating",function(e){s.logs.push(e.room+"频道的"+e.socketId+"发言: [ "+e.msg+" ]"),e.msg=window.tlrtcfile.escapeHtml().escape(e.msg),s.chatingList.push(e),s.chatingTpl()}),this.socket.on("manageCheck",function(e){window.layer&&layer.prompt({formType:1,title:"请输入"},function(e,t,i){s.socket.emit("manageConfirm",{room:s.roomId,value:e}),layer.close(t)})}),this.socket.on("manage",function(e){window.layer&&(e.socketId!==s.socketId?layer.msg("非法触发事件"):(layer.closeAll(),s.token=e.token,layer.load(2,{time:1e3,shade:[.8,"#000000"],success:function(e){layer.setTop(e)}}),setTimeout(()=>{s.manageIframeId=layer.tab({area:["100%","100%"],shade:[.8,"#393D49"],tab:[{title:e.content[0].title,content:e.content[0].html},{title:e.content[1].title,content:e.content[1].html},{title:e.content[2].title,content:e.content[2].html}],cancel:function(e,t){s.manageIframeId=0}}),layer.full(s.manageIframeId)},500)))}),this.socket.on("close",function(e){e=e.msg||"";e&&window.layer.open({title:"网站自动通知-"+(new Date).toLocaleString(),content:e})})},webrtcCheck:function(){window.tlrtcfile&&($("#check").removeClass("layui-anim-rotate"),setTimeout(()=>{$("#check").addClass("layui-anim-rotate");var e=tlrtcfile.supposeWebrtc();window.layer&&layer.msg(`你的浏览器${e?"支持":"不支持"}webrtc`)},50))},initCss:function(e){e&&(1===this.currentMenu?this.clickHome(!1):2===this.currentMenu?this.clickReceive(!1):3===this.currentMenu&&this.clickTxt(!1),this.reCaculateSwiperSize(),window.layer&&0!==this.manageIframeId&&layer.full(this.manageIframeId),document.querySelector("#selfMediaShareVideo_full")&&(document.querySelector("#selfMediaShareVideo_full").parentElement.style.height="auto"),document.querySelector("#otherMediaShareVideo_full")&&(document.querySelector("#otherMediaShareVideo_full").parentElement.style.height="auto"),this.logsHeight=document.documentElement.clientHeight-55)},reCaculateSwiperSize:function(){var e,t=document.body.clientWidth;window.userRoomSwiper&&(e=parseInt(t/100)-1,window.userRoomSwiper.params.slidesPerView=e),window.fileRoomSwiper&&(e=parseInt(t/100)-1,window.fileRoomSwiper.params.slidesPerView=e),window.fileRoomDisabledSwiper&&(e=parseInt(t/100)-1,window.fileRoomDisabledSwiper.params.slidesPerView=e),window.mediaShareRoomSwiper&&(e=parseInt(t/100)-1,window.mediaShareRoomSwiper.params.slidesPerView=e)},touchResize:function(){let t=this;setTimeout(()=>{var e=new Event("resize");window.dispatchEvent(e),t.reCaculateSwiperSize()},100)}},created:function(){let o=this;window.location.hash&&window.location.hash.includes("debug")&&window.tlrtcfile.loadJS("/static/js/vconsole.min.js",function(){window.tlrtcfile.loadJS("/static/js/vconsole.js",function(){console.log("load vconsole success")})}),window.location.search&&window.location.search.includes("notice=iamtsm&msg=")&&setTimeout(()=>{var e=window.location.search.split("msg=")[1];o.socket.emit("close",{msg:decodeURIComponent(e)})},2e3),setTimeout(()=>{o.handlerRoomHistory(),o.socket.emit("getCommData",{}),window.upload&&upload.render({elem:"#chooseFileList",accept:"file",auto:!1,drag:!0,multiple:!0,choose:function(i){for(let t in i.pushFile()){var e=0<o.sendFileList.filter(e=>e.name===i.pushFile()[t].name&&e.size===i.pushFile()[t].size&&e.type===i.pushFile()[t].type).length;e&&window.layer&&layer.msg("已过滤发送过的文件"),e||o.chooseFileList.push(Object.assign(i.pushFile()[t],{index:"file"+t,fileSendStatus:0,offset:0}))}}})},2e3)},mounted:function(){this.$nextTick(()=>{this.logs.push("socket 初始化中..."),this.socketListener(),this.logs.push("socket 初始化成功")}),this.clickHome(!1),window.onresize=this.initCss,window.Bus.$on("changeScreenState",e=>{this.isScreen=e}),window.Bus.$on("changeScreenTimes",e=>{this.screenTimes=e}),window.Bus.$on("changeScreenShareState",e=>{this.isScreenShare=e}),window.Bus.$on("changeScreenShareTimes",e=>{0===e&&this.socket.emit("message",{emitType:"stopScreenShare",id:this.socketId,room:this.roomId,cost:this.screenShareTimes}),this.screenShareTimes=e}),window.Bus.$on("changeVideoShareState",e=>{this.isVideoShare=e}),window.Bus.$on("changeVideoShareTimes",e=>{0===e&&this.socket.emit("message",{emitType:"stopVideoShare",id:this.socketId,room:this.roomId,cost:this.videoShareTimes}),this.videoShareTimes=e}),window.Bus.$on("sendChating",e=>{this.sendChating()}),window.Bus.$on("manageChange",e=>{this.socket.emit("manageChange",{id:e.id,room:this.roomId,token:this.token,content:e.content})}),window.Bus.$on("manageReload",e=>{this.socket.emit("manageReload",{id:e.id,room:this.roomId,token:this.token,content:e.time})}),window.Bus.$on("webrtcCheck",e=>{this.webrtcCheck()}),window.Bus.$on("sendBugs",e=>{this.sendBugs()})},destroyed:function(){}}),window.manageReload=function(e){window.Bus.$emit("manageReload",e)},window.manageChange=function(e){window.Bus.$emit("manageChange",e)},window.sendChating=function(){window.Bus.$emit("sendChating",{})},window.webrtcCheck=function(){window.Bus.$emit("webrtcCheck",{})},window.sendBugs=function(){window.Bus.$emit("sendBugs",{})}})}],o={},n.m=i,n.c=o,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1);function n(e){var t;return(o[e]||(t=o[e]={i:e,l:!1,exports:{}},i[e].call(t.exports,t,t.exports,n),t.l=!0,t)).exports}var i,o});